#!/usr/bin/env php
<?php

array_shift($_SERVER['argv']);

if (!$_SERVER['argv']) {
    fail("Usage: slimdump {DSN} {config.xml ...}");
}

$possibleAutoloadFiles = array(
    __DIR__ . '/../vendor/autoload.php',
    __DIR__ . '/../../../autoload.php'
);
foreach ($possibleAutoloadFiles as $autoloadFile) {
    if (file_exists($autoloadFile)) {
        require_once $autoloadFile;
    }
}


use \Webfactory\Slimdump\Config\ConfigBuilder;
use \Webfactory\Slimdump\Slimdump;

$db = connect(array_shift($_SERVER['argv']));

$config = ConfigBuilder::createConfigurationFromConsecutiveFiles($_SERVER['argv']);
$slimdump = new Slimdump();
$slimdump->dump($config, $db);
